---
import Location from "../assets/svg/map-pin.svg";
import Phone from "../assets/svg/phone.svg";
import Mail from "../assets/svg/mail.svg";
import WhatsApp from "../assets/svg/brand-whatsapp.svg";
---

<section id="contacto" class="py-20 bg-gray-100">
  <div class="text-center mb-16 pt-16 px-12">
    <h2 class="text-4xl font-semibold text-orange-600 mb-4">Contacto</h2>
    <p class="text-2xl text-gray-700">
      Si tienes alguna pregunta o necesitas más información, no dudes en
      contactarnos.
    </p>
  </div>

  <div
    class="container mx-auto px-4 relative z-10 flex flex-col lg:flex-row"
  >
    <!-- Text Content -->
    <div class="lg:w-2/3 text-center lg:text-left mb-8 lg:mb-0">
      <div class="mx-auto lg:pl-11 lg:mx-0">
        <!-- Contact Form Section -->
        <div
          class="bg-white p-8 rounded-lg shadow-md col-span-1 md:col-span-1 lg:col-span-1"
        >
          <h2 class="text-3xl font-semibold text-orange-600 mb-6">
            Formulario de Contacto
          </h2>
          <form id="contact-form"
          action="/api/contact"
          method="POST">
            <!-- Name and Last Name in one row for larger screens and stacked for smaller ones -->
            <div class="flex flex-col md:flex-row gap-6 mb-4">
              <div class="w-full">
                <label for="firstName" class="block text-gray-700">Nombre</label
                >
                <input
                  type="text"
                  id="from_name"
                  name="from_name"
                  class="w-full p-3 mt-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-600"
                  required
                />
              </div>
              <div class="w-full">
                <label for="lastName" class="block text-gray-700"
                  >Apellido</label
                >
                <input
                  type="text"
                  id="from_last_name"
                  name="from_last_name"
                  class="w-full p-3 mt-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-600"
                  required
                />
              </div>
            </div>

            <!-- Email and Phone in one row for larger screens and stacked for smaller ones -->
            <div class="flex flex-col md:flex-row gap-6 mb-4">
              <div class="w-full">
                <label for="email" class="block text-gray-700"
                  >Correo Electrónico</label
                >
                <input
                  type="email"
                  id="reply_to"
                  name="reply_to"
                  class="w-full p-3 mt-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-600"
                  required
                />
              </div>
              <div class="w-full">
                <label for="phone" class="block text-gray-700">Teléfono</label>
                <input
                  type="tel"
                  id="reply_phone"
                  name="reply_phone"
                  class="w-full p-3 mt-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-600"
                  required
                />
              </div>
            </div>

            <!-- Message Textarea -->
            <div class="mb-4">
              <label for="message" class="block text-gray-700">Mensaje</label>
              <textarea
                id="message"
                name="message"
                rows="3"
                class="w-full p-3 mt-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-600"
                required></textarea>
            </div>

            <div class="flex justify-start  gap-4 items-center">
              <button
              id="submit-button"
                type="submit"
                class="bg-orange-600 text-white px-8 py-3 rounded-full hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-600"
                >Enviar</button>
                <!-- Animación: Enviando mensaje -->
                <div
                  id="progress-message"
                  class="hidden flex items-center gap-2 text-sm text-orange-600 animate-pulse"
                >
                  <svg class="w-5 h-5 animate-spin" viewBox="0 0 24 24" fill="none">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 00-8 8h4z"/>
                  </svg>
                  Enviando mensaje...
                </div>
            </div>
          </form>
          <!-- Animación: Mensaje enviado -->
          <div
            id="form-message"
            class="hidden mt-6 text-green-600 text-lg font-semibold animate-fade-in-up"
          >
            ✅ ¡Gracias por enviarnos tu contacto! En breve nos comunicaremos contigo.
          </div>
        </div>
      </div>
    </div>

    <!-- Image Section -->
    <div class="lg:w-1/3 mt-8 lg:mt-0">
      <div
        class="bg-white p-8 rounded-lg shadow-md col-span-1 md:col-span-1 lg:col-span-1 max-w-md mx-auto h-full"
      >
        <h2 class="text-3xl font-semibold text-orange-600 mb-6">
          Información de Contacto
        </h2>
        <div class="text-2xl font-bold flex items-center mb-4">
          <img src="/mva-logo-rb.png" alt="Logo" class="h-12 w-12 mr-2" />
          <h1 class="text-orange-600">Mva Foods</h1>
        </div>
        <p class="text-lg text-gray-700 mb-4">
          Puedes ponerte en contacto con nosotros a través de los siguientes
          medios:
        </p>

        <!-- Email -->
        <div class="relative flex items-center mb-4 cursor-pointer select-none" id="email-copy">
          <Mail class="text-2xl text-orange-600 mr-4" />
          <p class="text-gray-700 underline hover:text-orange-600 transition-colors">
            escalate.soft.soluctions@gmail.com
          </p>

          <!-- Tooltip -->
          <div
            id="tooltip"
            class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 rounded bg-orange-600 text-white text-xs px-2 py-1 opacity-0 pointer-events-none transition-opacity"
          >
            Copiado
          </div>
        </div>
        <!-- Phone -->
        <div class="flex items-center mb-4">
          <Phone class="text-2xl text-orange-600 mr-4" />
          <p class="text-gray-700">(866) 142-5258</p>
        </div>
        <!-- WhatsApp -->
        <div class="flex items-center mb-4">
          <WhatsApp class="text-2xl text-orange-600 mr-4" />
          <a
            href="https://wa.me/+5218661425258?text=Hola%2C%20me%20interesa%20saber%20como%20puedo%20adquirir%20Mva%20Foods%20para%20mi%20negocio"
            target="_blank"
            rel="noopener noreferrer"
            class="text-gray-700 hover:text-orange-600 transition-colors"
          >
            (866) 142-5258
          </a>
        </div>


        <!-- Location -->
        <div class="flex items-start">
          <div class="">
            <Location class="text-2xl text-orange-600 mr-4" />

          </div>
          <p class="text-gray-700">Geranio 816, Guadalupe Borja, 25670 Frontera, Coah.</p>
        </div>
      </div>
    </div>
  </div>
  
</section>


<script type="module" is:inline>
  const form = document.getElementById("contact-form");
  const formMessage = document.getElementById("form-message");
  const submitButton = document.getElementById("submit-button");
  const progressMessage = document.getElementById("progress-message");
  const emailDiv = document.getElementById("email-copy");
  const tooltip = document.getElementById("tooltip");
  const emailText = "escalate.soft.soluctions@gmail.com";

  emailDiv.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(emailText);
      // Mostrar tooltip
      tooltip.classList.remove("opacity-0");
      tooltip.classList.add("opacity-100");

      // Ocultar después de 2 segundos
      setTimeout(() => {
        tooltip.classList.remove("opacity-100");
        tooltip.classList.add("opacity-0");
      }, 2000);
    } catch {
      alert("No se pudo copiar el correo. Por favor copia manualmente.");
    }
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);

    // Deshabilitar botón y mostrar progreso
    submitButton.disabled = true;
    submitButton.classList.add("opacity-40", "cursor-not-allowed");
    progressMessage.classList.remove("hidden");

    try {
      const response = await fetch("/api/contact", {
        method: "POST",
        body: formData,
      });

      if (response.ok) {
        form.reset();
        form.style.display = "none";
        formMessage.classList.remove("hidden");
      } else {
        const data = await response.json();
        console.error("Error response:", data);
        alert("Hubo un problema al enviar el mensaje.");
      }
    } catch (error) {
      console.error("Error:", error);
      alert("Error al enviar el mensaje.");
    } finally {
      // Rehabilitar botón y ocultar progreso (solo si no fue exitoso)
      if (form.style.display !== "none") {
        submitButton.disabled = false;
        submitButton.classList.remove("opacity-40", "cursor-not-allowed");
        progressMessage.classList.add("hidden");
      }
    }
  });
</script>

